# carbon
Carbon is a fast and lightweight log transport and processing agent. It's designed as a modern replacement for Fluentd, Fluent Bit, and Logstash.

[![<observIQ>](https://circleci.com/gh/observIQ/carbon.svg?style=shield&circle-token=980a514f9dc5a48ac2b8e61a4cdb7555ea5646ca)](https://app.circleci.com/pipelines/github/observIQ/carbon)
[![codecov](https://codecov.io/gh/observIQ/carbon/branch/master/graph/badge.svg?token=i50h3UFXLg)](https://codecov.io/gh/observIQ/carbon)
[![Go Report Card](https://goreportcard.com/badge/github.com/observIQ/carbon)](https://goreportcard.com/report/github.com/observIQ/carbon)

## How do I install the agent?

We recommend using our single-line installer provided with each release:

### Linux
```shell
sh -c "$(curl -fsSlL https://github.com/observiq/carbon/releases/latest/download/unix-install.sh)" unix-install.sh
```
### macOS
```shell
sh -c "$(curl -fsSlL https://github.com/observiq/carbon/releases/latest/download/unix-install.sh)" unix-install.sh
```
### Windows
```pwsh
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 ; Invoke-Expression ((New-Object net.webclient).DownloadString('https://github.com/observiq/carbon/releases/latest/download/windows-install.ps1')); Log-Agent-Install
```

## How do I run the agent?

If you installed the agent using the single-line installer above, it's already running as a service! If you'd like to start or stop the agent, here's how:

### Linux
```shell
# systemd
systemctl start carbon
systemctl stop carbon

# sysv
service carbon start
service carbon stop
```
### macOS
```shell
launchctl start com.observiq.carbon
launchctl stop com.observiq.carbon
```
### Windows
```pwsh
Start-Service -Name "carbon"
Stop-Service -Name "carbon"
```

### Manual

If you'd like to run the agent manually rather than as a service, you can do that, too!

```shell
# Example Command
carbon

# Supported flags:
--config      The location of the agent config file (default: ./config.yaml)
--plugin_dir  The location of the plugins directory (default: ./plugins)
--database    The location of the offsets database file. If this is not specified, offsets will not be maintained across agent restarts
--log_file    The location of the agent log file. If not specified, carbon will log to `stderr`
--debug       Enables debug logging
```

## How do I configure the agent?
A simple configuration file (config.yaml) is included in the installation. By default it doesn't do much, but is an easy way to get started. By default, it generates a single log entry and sends it to STDOUT every time the agent is restarted.

```yaml
pipeline:
  # An example input that generates a single log entry when Carbon starts up.
  - type: generate_input
    count: 1
    entry:
      record: This is a sample log generated by Carbon
...
  # An example output that sends captured logs to stdout.
  - type: stdout
...
```

The first step in configuring carbon is to setup your output. The sample configuration provides examples for sending data to the Elastic stack or Google Cloud Monitoring. Uncomment the destination of your choice and add in your own credentials and host. Restart the agent to generate another log line.

```yaml
...
pipeline:
  # An example input that generates a single log entry when Carbon starts up.
  - type: generate_input
    count: 1
    entry:
      record: This is a sample log generated by Carbon

  # An example output that sends captured logs to elasticsearch.
  # For more info: https://github.com/observIQ/carbon/blob/master/docs/operators/elastic_output.md
  - type: elastic_output
    addresses:
      - http://my_node_address:9200
    api_key: my_api_key
...
```

Once you've confirmed you're able to send a log entry, you'll want to connect carbon to a log file you're interested in monitoring. We've included a sample `file_input` configuration in the config file to use (carbon also provide options for UDP, TCP, syslog, and other input streams. They're available [here](./docs/README.md)).
```yaml
...
pipeline:
...
  # An example input that monitors the contents of a file.
  # For more info: https://github.com/observIQ/carbon/blob/master/docs/operators/file_input.md
  - type: file_input
    include:
       - /sample/file/path
  ...

  # An example output that sends captured logs to elasticsearch.
  # For more info: https://github.com/observIQ/carbon/blob/master/docs/operators/elastic_output.md
  - type: elastic_output
    addresses:
      - http://my_node_address:9200
    api_key: my_api_key
...
```

That's it! You should have logs streaming to Elasticsearch. From here you can explore all the options available within carbon! You can use existing plugins from our plugin repository or build your own custom pipelines.

To learn more about configuration, visit our [docs](./docs/README.md).

### Can I route logs through a proxy server?
Yes. The agent will respect `http_proxy` and `https_proxy` environment variables, as defined in Golang's [net/http](https://golang.org/pkg/net/http/#ProxyFromEnvironment) package.

## How do I contribute?

First, check out our section on [`getting started with development`](./docs/development.md)

Next, take a look at our contribution guidelines in [`CONTRIBUTING.md`](./CONTRIBUTING.md)
